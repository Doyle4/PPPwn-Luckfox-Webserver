<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PPPwn-Luckfox GoldHEN Host - All FW</title>
    <link rel="stylesheet" href="../utils/style.css">
    <script>
        const payloadFiles = {
            app2usb: 'app2usb.bin.bz2',
            appDumper: 'app-dumper.bin.bz2',
            backup: 'backup.bin.bz2',
            disableASLR: 'disable-aslr.bin.bz2',
            disableUpdates: 'disable-updates.bin.bz2',
            enableBrowser: 'enable-browser.bin.bz2',
            enableUpdates: 'enable-updates.bin.bz2',
            exitIDU: 'exit-idu.bin.bz2',
            ftp: 'ftp.bin.bz2',
            historyBlocker: 'history-blocker.bin.bz2',
            kernelClock: 'kernel-clock.bin.bz2',
            kernelDumper: 'kernel-dumper.bin.bz2',
            moduleDumper: 'module-dumper.bin.bz2',
            permanentUART: 'permanent-uart.bin.bz2',
            pupDecrypt: 'pupDecrypt.bin.bz2',
            restore: 'restore.bin.bz2',
            rifRenamer: 'rif-renamer.bin.bz2',
            toDex: 'todex.bin.bz2'
        };

        function getPayload(payload, onLoadEndCallback) {
            const req = new XMLHttpRequest();
            req.open('GET', payload);
            req.responseType = "arraybuffer";
            req.onload = event => onLoadEndCallback && onLoadEndCallback(req, event);
            req.send();
        }

        function sendPayload(url, data, onLoadEndCallback) {
            const req = new XMLHttpRequest();
            req.open("POST", url, true);
            req.onload = event => onLoadEndCallback && onLoadEndCallback(req, event);
            req.send(data);
        }

        function injectPayload(file) {
            if (file.endsWith(".bz2")){
               loadPayloadBZ2(file);
            } else{
               loadPayload(file);
            }
        }

        function loadPayload(file) {
            const statusUrl = "http://127.0.0.1:9090/status";
            const payloadUrl = "http://127.0.0.1:9090";
            const req = new XMLHttpRequest();
            req.open("POST", statusUrl);
            req.onerror = () => alert("Cannot Load Payload Because The BinLoader Server Is Not Running");
            req.onload = () => {
                const responseJson = JSON.parse(req.responseText);
                if (responseJson.status === "ready") {
                    getPayload(file, req => {
                        if ((req.status === 200 || req.status === 304) && req.response) {
                            sendPayload(payloadUrl, req.response, req => {
                              progress.innerHTML = req.status === 200 ? "Payload Loaded" : 'Cannot send payload';
                            });
                        }
                    });
                } else {
                    alert("Cannot Load Payload Because The BinLoader Server Is Busy");
                }
            };
            req.send();
        }

        function loadPayloadBZ2(file) {
            const statusUrl = "http://127.0.0.1:9090/status";
            const payloadUrl = "http://127.0.0.1:9090";
            var req = new XMLHttpRequest();
            req.open("POST", statusUrl);
            req.onerror = () => alert("Cannot Load Payload Because The BinLoader Server Is Not Running");
            req.onload = () => {
               var responseJson = JSON.parse(req.responseText);
               if (responseJson.status == "ready") {
                     getPayload(file, req => {
                        if ((req.status === 200 || req.status === 304) && req.response) {
                           let payloadData = new Uint8Array(req.response);
                           try {
                              payloadData = bzip2.simple(bzip2.array(payloadData));
                           } catch (error) {
                              throw error;
                           }
                           sendPayload(payloadUrl, payloadData.buffer, req => {
                              progress.innerHTML = req.status === 200 ? "Payload Loaded" : 'Cannot send payload';
                           });
                        }
                     });
               } else {
                  alert("Cannot Load Payload Because The BinLoader Server Is Busy");
                  return;
               }
            };
            req.send();
         }

         function loadFanControl() {
            progress.innerHTML = "Fan Control loading... please wait";
            injectPayload(`fan${tempC.value}.bin.bz2`);
         }

         function setTemperatureOptions() {
            const select = document.getElementById("tempC");
            for (let i = 50; i <= 80; i += 5) {
               const option = document.createElement("option");
               option.text = i;
               option.value = i;
               select.add(option);
            }
            select.value = 60;
            localStorage.setItem("fanthreshold", select.value);
         }

         document.addEventListener("DOMContentLoaded", setTemperatureOptions);
    </script>
    <script src="../utils/bzip.js"></script>
</head>

<body>
    <div class="container">
        <h1>PPPwn-Luckfox GoldHEN Host - All FW</h1>
        <h2 id="progress" style="color: blue;">Status</h2>
        <div id="all">
            <button class="button" onmouseover="progress.innerHTML='App2USB for PS4 all fw upto 11.50'" onmouseout="progress.innerHTML='Status'" onclick="injectPayload(payloadFiles.app2usb)">App2USB</button>
            <button class="button" onmouseover="progress.innerHTML='App Dumper for PS4 all fw upto 11.50'" onmouseout="progress.innerHTML='Status'" onclick="injectPayload(payloadFiles.appDumper)">App Dumper</button>
            <button class="button" onmouseover="progress.innerHTML='Backup for PS4 all fw upto 11.50'" onmouseout="progress.innerHTML='Status'" onclick="injectPayload(payloadFiles.backup)">Backup</button>
            <button class="button" onmouseover="progress.innerHTML='Disable ASLR for PS4 all fw upto 11.50'" onmouseout="progress.innerHTML='Status'" onclick="injectPayload(payloadFiles.disableASLR)">Disable ASLR</button>
            <br/> <br/>
            <button class="button" onmouseover="progress.innerHTML='Disable Updates for PS4 all fw upto 11.50'" onmouseout="progress.innerHTML='Status'" onclick="injectPayload(payloadFiles.disableUpdates)">Disable Updates</button>
            <button class="button" onmouseover="progress.innerHTML='Enable Browser for PS4 all fw upto 11.50'" onmouseout="progress.innerHTML='Status'" onclick="injectPayload(payloadFiles.enableBrowser)">Enable Browser</button>
            <button class="button" onmouseover="progress.innerHTML='Enable Updates for PS4 all fw upto 11.50'" onmouseout="progress.innerHTML='Status'" onclick="injectPayload(payloadFiles.enableUpdates)">Enable Updates</button>
            <button class="button" onmouseover="progress.innerHTML='Exit IDU for PS4 all fw upto 11.50'" onmouseout="progress.innerHTML='Status'" onclick="injectPayload(payloadFiles.exitIDU)">Exit IDU</button>
            <br/> <br/>
            <button class="button" onmouseover="progress.innerHTML='FTP for PS4 all fw upto 11.50'" onmouseout="progress.innerHTML='Status'" onclick="injectPayload(payloadFiles.ftp)">FTP</button>
            <button class="button" onmouseover="progress.innerHTML='History Blocker for PS4 all fw upto 11.50'" onmouseout="progress.innerHTML='Status'" onclick="injectPayload(payloadFiles.historyBlocker)">History Blocker</button>
            <button class="button" onmouseover="progress.innerHTML='Kernel Clock for PS4 all fw upto 11.50'" onmouseout="progress.innerHTML='Status'" onclick="injectPayload(payloadFiles.kernelClock)">Kernel Clock</button>
            <button class="button" onmouseover="progress.innerHTML='Kernel Dumper for PS4 all fw upto 11.50'" onmouseout="progress.innerHTML='Status'" onclick="injectPayload(payloadFiles.kernelDumper)">Kernel Dumper</button>
            <br/> <br/>
            <button class="button" onmouseover="progress.innerHTML='Module Dumper for PS4 all fw upto 11.50'" onmouseout="progress.innerHTML='Status'" onclick="injectPayload(payloadFiles.moduleDumper)">Module Dumper</button>
            <button class="button" onmouseover="progress.innerHTML='Permanent UART for PS4 all fw upto 11.50'" onmouseout="progress.innerHTML='Status'" onclick="injectPayload(payloadFiles.permanentUART)">Permanent UART</button>
            <button class="button" onmouseover="progress.innerHTML='PUP Decrypt for PS4 all fw upto 11.50'" onmouseout="progress.innerHTML='Status'" onclick="injectPayload(payloadFiles.pupDecrypt)">PUP Decrypt</button>
            <button class="button" onmouseover="progress.innerHTML='DB-Restore for PS4 all fw upto 11.50'" onmouseout="progress.innerHTML='Status'" onclick="injectPayload(payloadFiles.restore)">DB-Restore</button>
            <br/> <br/>
            <button class="button" onmouseover="progress.innerHTML='RIF Renamer for PS4 all fw upto 11.50'" onmouseout="progress.innerHTML='Status'" onclick="injectPayload(payloadFiles.rifRenamer)">RIF Renamer</button>
            <button class="button" onmouseover="progress.innerHTML='ToDex for PS4 all fw upto 11.50'" onmouseout="progress.innerHTML='Status'" onclick="injectPayload(payloadFiles.toDex)">ToDex</button>
            <button class="button" onmouseover="progress.innerHTML='Set the temperature at the PS4 fan starts'" onmouseout="progress.innerHTML='Status'" onclick="injectPayload('fan' + tempC.value + '.bin.bz2')"> Fan Control </button>
            <select id="tempC"></select>
            <br/> <br/>
            <button class="button" onclick="window.location.href = '../'" onmouseover="progress.innerHTML='Move back to PPPwn-Dashboard'" onmouseout="progress.innerHTML='Status'">Back</button>
        </div>
    </div>
</body>

</html>
